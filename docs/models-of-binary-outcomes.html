<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5.2 Models of Binary Outcomes | Statistical Modeling: A Tools Approach</title>
  <meta name="description" content="Lecture notes covering the key tools of regression modeling in political science." />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="5.2 Models of Binary Outcomes | Statistical Modeling: A Tools Approach" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Lecture notes covering the key tools of regression modeling in political science." />
  <meta name="github-repo" content="pos5747/adv-methods-notes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5.2 Models of Binary Outcomes | Statistical Modeling: A Tools Approach" />
  
  <meta name="twitter:description" content="Lecture notes covering the key tools of regression modeling in political science." />
  

<meta name="author" content="Carlisle Rainey" />


<meta name="date" content="2022-09-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="measures-of-model-fit.html"/>
<link rel="next" href="week-6-an-explosion-of-quantities-of-interest.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>
<script>
    $(document).ready(function () {
        process_solutions();
    });
    function process_solutions() {
        $("div.section[id^='solution']").each(function(i) {
        var soln_wrapper_id = "cvxr_ex_" + i;
        var solution_id = $(this).attr('id');
        var button = $("<button onclick=\"toggle_solution('" + soln_wrapper_id + "')\">Show/Hide</button>");
        var new_div = $("<div id='" + soln_wrapper_id + "' class='solution' style='display: none;'></div>");
        var h = $(this).first();
        var others = $(this).children().slice(1);
        $(others).each(function() {
            $(this).appendTo($(new_div));
        });
        $(button).insertAfter($(h));
        $(new_div).insertAfter($(button));
        })
    }
    function toggle_solution(el_id) {
      $("#" + el_id).toggle();
    } 
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Methods Notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Week 1: Maximum Likelihood<span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="class-agenda.html"><a href="class-agenda.html"><i class="fa fa-check"></i><b>1.1</b> Class agenda<span></span></a></li>
<li class="chapter" data-level="1.2" data-path="maximum-likelihood.html"><a href="maximum-likelihood.html"><i class="fa fa-check"></i><b>1.2</b> Maximum Likelihood<span></span></a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="maximum-likelihood.html"><a href="maximum-likelihood.html#example-bernoulli-distribution"><i class="fa fa-check"></i><b>1.2.1</b> Example: Bernoulli Distribution<span></span></a></li>
<li class="chapter" data-level="1.2.2" data-path="maximum-likelihood.html"><a href="maximum-likelihood.html#example-poisson-distribution"><i class="fa fa-check"></i><b>1.2.2</b> Example: Poisson Distribution<span></span></a></li>
<li class="chapter" data-level="1.2.3" data-path="maximum-likelihood.html"><a href="maximum-likelihood.html#remarks"><i class="fa fa-check"></i><b>1.2.3</b> Remarks<span></span></a></li>
<li class="chapter" data-level="1.2.4" data-path="maximum-likelihood.html"><a href="maximum-likelihood.html#example-beta-distribution"><i class="fa fa-check"></i><b>1.2.4</b> Example: Beta Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="the-invariance-property.html"><a href="the-invariance-property.html"><i class="fa fa-check"></i><b>1.3</b> The Invariance Property<span></span></a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="the-invariance-property.html"><a href="the-invariance-property.html#example-bernoulli-odds"><i class="fa fa-check"></i><b>1.3.1</b> Example: Bernoulli Odds<span></span></a></li>
<li class="chapter" data-level="1.3.2" data-path="the-invariance-property.html"><a href="the-invariance-property.html#example-poisson-sd"><i class="fa fa-check"></i><b>1.3.2</b> Example: Poisson SD<span></span></a></li>
<li class="chapter" data-level="1.3.3" data-path="the-invariance-property.html"><a href="the-invariance-property.html#example-beta-mean-and-variance"><i class="fa fa-check"></i><b>1.3.3</b> Example: Beta Mean and Variance<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>1.4</b> The Parametric Bootstrap<span></span></a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#example-toothpaste-cap-problm"><i class="fa fa-check"></i><b>1.4.1</b> Example: Toothpaste Cap Problm<span></span></a></li>
<li class="chapter" data-level="1.4.2" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#example-beta-distribution-1"><i class="fa fa-check"></i><b>1.4.2</b> Example: Beta Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="sampling-distribution.html"><a href="sampling-distribution.html"><i class="fa fa-check"></i><b>1.5</b> Sampling Distribution<span></span></a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="sampling-distribution.html"><a href="sampling-distribution.html#example-the-toothpaste-cap-problem"><i class="fa fa-check"></i><b>1.5.1</b> Example: The Toothpaste Cap Problem<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="bias.html"><a href="bias.html"><i class="fa fa-check"></i><b>1.6</b> Bias<span></span></a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="bias.html"><a href="bias.html#example-bernoulli-distribution-1"><i class="fa fa-check"></i><b>1.6.1</b> Example: Bernoulli Distribution<span></span></a></li>
<li class="chapter" data-level="1.6.2" data-path="bias.html"><a href="bias.html#example-poisson-distribution-1"><i class="fa fa-check"></i><b>1.6.2</b> Example: Poisson Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="consistency.html"><a href="consistency.html"><i class="fa fa-check"></i><b>1.7</b> Consistency<span></span></a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="consistency.html"><a href="consistency.html#example-illustrative"><i class="fa fa-check"></i><b>1.7.1</b> Example: Illustrative<span></span></a></li>
<li class="chapter" data-level="1.7.2" data-path="consistency.html"><a href="consistency.html#example-bernoulli-odds-1"><i class="fa fa-check"></i><b>1.7.2</b> Example: Bernoulli Odds<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="predictive-distribution.html"><a href="predictive-distribution.html"><i class="fa fa-check"></i><b>1.8</b> Predictive Distribution<span></span></a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="predictive-distribution.html"><a href="predictive-distribution.html#example-poisson-distribution-2"><i class="fa fa-check"></i><b>1.8.1</b> Example: Poisson Distribution<span></span></a></li>
<li class="chapter" data-level="1.8.2" data-path="predictive-distribution.html"><a href="predictive-distribution.html#example-beta-distribution-2"><i class="fa fa-check"></i><b>1.8.2</b> Example: Beta Distribution<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="week-2-bayesian-inference.html"><a href="week-2-bayesian-inference.html"><i class="fa fa-check"></i><b>2</b> Week 2: Bayesian Inference<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="bayesian-inference.html"><a href="bayesian-inference.html"><i class="fa fa-check"></i><b>2.1</b> Bayesian Inference<span></span></a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="bayesian-inference.html"><a href="bayesian-inference.html#mechanics"><i class="fa fa-check"></i><b>2.1.1</b> Mechanics<span></span></a></li>
<li class="chapter" data-level="2.1.2" data-path="bayesian-inference.html"><a href="bayesian-inference.html#posterior-summaries"><i class="fa fa-check"></i><b>2.1.2</b> Posterior Summaries<span></span></a></li>
<li class="chapter" data-level="2.1.3" data-path="bayesian-inference.html"><a href="bayesian-inference.html#posterior-simulation"><i class="fa fa-check"></i><b>2.1.3</b> Posterior Simulation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="example-bernoulli.html"><a href="example-bernoulli.html"><i class="fa fa-check"></i><b>2.2</b> Example: Bernoulli<span></span></a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="example-bernoulli.html"><a href="example-bernoulli.html#likelihood"><i class="fa fa-check"></i><b>2.2.1</b> The Likelihood<span></span></a></li>
<li class="chapter" data-level="2.2.2" data-path="example-bernoulli.html"><a href="example-bernoulli.html#the-prior"><i class="fa fa-check"></i><b>2.2.2</b> The Prior<span></span></a></li>
<li class="chapter" data-level="2.2.3" data-path="example-bernoulli.html"><a href="example-bernoulli.html#the-posterior"><i class="fa fa-check"></i><b>2.2.3</b> The Posterior<span></span></a></li>
<li class="chapter" data-level="2.2.4" data-path="example-bernoulli.html"><a href="example-bernoulli.html#point-estimates"><i class="fa fa-check"></i><b>2.2.4</b> Point Estimates<span></span></a></li>
<li class="chapter" data-level="2.2.5" data-path="example-bernoulli.html"><a href="example-bernoulli.html#credible-interval"><i class="fa fa-check"></i><b>2.2.5</b> Credible Interval<span></span></a></li>
<li class="chapter" data-level="2.2.6" data-path="example-bernoulli.html"><a href="example-bernoulli.html#simulation"><i class="fa fa-check"></i><b>2.2.6</b> Simulation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="example-poisson-distribution-3.html"><a href="example-poisson-distribution-3.html"><i class="fa fa-check"></i><b>2.3</b> Example: Poisson Distribution<span></span></a></li>
<li class="chapter" data-level="2.4" data-path="remarks-1.html"><a href="remarks-1.html"><i class="fa fa-check"></i><b>2.4</b> Remarks<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="week-3-adding-predictors.html"><a href="week-3-adding-predictors.html"><i class="fa fa-check"></i><b>3</b> Week 3: Adding Predictors<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="review-the-normal-model.html"><a href="review-the-normal-model.html"><i class="fa fa-check"></i><b>3.1</b> Review: The Normal Model<span></span></a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="review-the-normal-model.html"><a href="review-the-normal-model.html#distribution"><i class="fa fa-check"></i><b>3.1.1</b> Distribution<span></span></a></li>
<li class="chapter" data-level="3.1.2" data-path="review-the-normal-model.html"><a href="review-the-normal-model.html#linear-predictor"><i class="fa fa-check"></i><b>3.1.2</b> Linear Predictor<span></span></a></li>
<li class="chapter" data-level="3.1.3" data-path="review-the-normal-model.html"><a href="review-the-normal-model.html#fitting-the-normal-linear-model"><i class="fa fa-check"></i><b>3.1.3</b> Fitting the Normal-Linear Model<span></span></a></li>
<li class="chapter" data-level="3.1.4" data-path="review-the-normal-model.html"><a href="review-the-normal-model.html#applied-example"><i class="fa fa-check"></i><b>3.1.4</b> Applied Example<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="bernoulli-model.html"><a href="bernoulli-model.html"><i class="fa fa-check"></i><b>3.2</b> Bernoulli Model<span></span></a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="bernoulli-model.html"><a href="bernoulli-model.html#the-linear-probability-model"><i class="fa fa-check"></i><b>3.2.1</b> The Linear Probability Model<span></span></a></li>
<li class="chapter" data-level="3.2.2" data-path="bernoulli-model.html"><a href="bernoulli-model.html#the-logit-model"><i class="fa fa-check"></i><b>3.2.2</b> The Logit Model<span></span></a></li>
<li class="chapter" data-level="3.2.3" data-path="bernoulli-model.html"><a href="bernoulli-model.html#fitting-a-logit-model"><i class="fa fa-check"></i><b>3.2.3</b> Fitting a Logit Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="poisson-model.html"><a href="poisson-model.html"><i class="fa fa-check"></i><b>3.3</b> Poisson Model<span></span></a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="poisson-model.html"><a href="poisson-model.html#predictive-distribution-1"><i class="fa fa-check"></i><b>3.3.1</b> Predictive Distribution<span></span></a></li>
<li class="chapter" data-level="3.3.2" data-path="poisson-model.html"><a href="poisson-model.html#posterior-predictive-distribution"><i class="fa fa-check"></i><b>3.3.2</b> Posterior Predictive Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="posterior-predictive-distribution-1.html"><a href="posterior-predictive-distribution-1.html"><i class="fa fa-check"></i><b>3.4</b> [Posterior] Predictive Distribution<span></span></a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="posterior-predictive-distribution-1.html"><a href="posterior-predictive-distribution-1.html#for-the-logit-model"><i class="fa fa-check"></i><b>3.4.1</b> … for the logit model<span></span></a></li>
<li class="chapter" data-level="3.4.2" data-path="posterior-predictive-distribution-1.html"><a href="posterior-predictive-distribution-1.html#for-the-poisson-model"><i class="fa fa-check"></i><b>3.4.2</b> … for the Poisson model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="quantities-of-interest.html"><a href="quantities-of-interest.html"><i class="fa fa-check"></i><b>3.5</b> Quantities of Interest<span></span></a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="quantities-of-interest.html"><a href="quantities-of-interest.html#expected-value"><i class="fa fa-check"></i><b>3.5.1</b> Expected Value<span></span></a></li>
<li class="chapter" data-level="3.5.2" data-path="quantities-of-interest.html"><a href="quantities-of-interest.html#first-difference"><i class="fa fa-check"></i><b>3.5.2</b> First Difference<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="week-4-confidence-intervals.html"><a href="week-4-confidence-intervals.html"><i class="fa fa-check"></i><b>4</b> Week 4: Confidence Intervals<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="the-parametric-bootstrap-1.html"><a href="the-parametric-bootstrap-1.html"><i class="fa fa-check"></i><b>4.1</b> The Parametric Bootstrap<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="the-nonparametric-bootstrap.html"><a href="the-nonparametric-bootstrap.html"><i class="fa fa-check"></i><b>4.2</b> The <em>Non</em>parametric Bootstrap<span></span></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="the-nonparametric-bootstrap.html"><a href="the-nonparametric-bootstrap.html#example-coefficients-from-the-civilian-casualties-model"><i class="fa fa-check"></i><b>4.2.1</b> Example: Coefficients from the Civilian Casualties Model<span></span></a></li>
<li class="chapter" data-level="4.2.2" data-path="the-nonparametric-bootstrap.html"><a href="the-nonparametric-bootstrap.html#example-first-difference-from-the-civilian-casualties-model"><i class="fa fa-check"></i><b>4.2.2</b> Example: First Difference from the Civilian Casualties Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="wald-confidence-intervals.html"><a href="wald-confidence-intervals.html"><i class="fa fa-check"></i><b>4.3</b> Wald Confidence Intervals<span></span></a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="wald-confidence-intervals.html"><a href="wald-confidence-intervals.html#curvature-in-a-single-dimmension"><i class="fa fa-check"></i><b>4.3.1</b> Curvature in a Single Dimmension<span></span></a></li>
<li class="chapter" data-level="4.3.2" data-path="wald-confidence-intervals.html"><a href="wald-confidence-intervals.html#curvature-in-a-multiple-dimmensions"><i class="fa fa-check"></i><b>4.3.2</b> Curvature in a Multiple Dimmensions<span></span></a></li>
<li class="chapter" data-level="4.3.3" data-path="wald-confidence-intervals.html"><a href="wald-confidence-intervals.html#from-curvature-to-confidence-intervals"><i class="fa fa-check"></i><b>4.3.3</b> From Curvature to Confidence Intervals<span></span></a></li>
<li class="chapter" data-level="4.3.4" data-path="wald-confidence-intervals.html"><a href="wald-confidence-intervals.html#final-notes"><i class="fa fa-check"></i><b>4.3.4</b> Final Notes<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="evaluating-confidence-intervals.html"><a href="evaluating-confidence-intervals.html"><i class="fa fa-check"></i><b>4.4</b> Evaluating Confidence Intervals<span></span></a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="evaluating-confidence-intervals.html"><a href="evaluating-confidence-intervals.html#coverage"><i class="fa fa-check"></i><b>4.4.1</b> Coverage<span></span></a></li>
<li class="chapter" data-level="4.4.2" data-path="evaluating-confidence-intervals.html"><a href="evaluating-confidence-intervals.html#monte-carlo-simulation-to-assess-coverage"><i class="fa fa-check"></i><b>4.4.2</b> Monte Carlo Simulation to Assess Coverage<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="week-5-models-of-binary-outcomes-and-model-fit-summaries.html"><a href="week-5-models-of-binary-outcomes-and-model-fit-summaries.html"><i class="fa fa-check"></i><b>5</b> Week 5: Models of Binary Outcomes and Model Fit Summaries<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="measures-of-model-fit.html"><a href="measures-of-model-fit.html"><i class="fa fa-check"></i><b>5.1</b> Measures of Model Fit<span></span></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="measures-of-model-fit.html"><a href="measures-of-model-fit.html#scoring-binary-predictions"><i class="fa fa-check"></i><b>5.1.1</b> Scoring Binary Predictions<span></span></a></li>
<li class="chapter" data-level="5.1.2" data-path="measures-of-model-fit.html"><a href="measures-of-model-fit.html#cross-validation"><i class="fa fa-check"></i><b>5.1.2</b> Cross-Validation<span></span></a></li>
<li class="chapter" data-level="5.1.3" data-path="measures-of-model-fit.html"><a href="measures-of-model-fit.html#information-criteria"><i class="fa fa-check"></i><b>5.1.3</b> Information Criteria<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="models-of-binary-outcomes.html"><a href="models-of-binary-outcomes.html"><i class="fa fa-check"></i><b>5.2</b> Models of Binary Outcomes<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="models-of-binary-outcomes.html"><a href="models-of-binary-outcomes.html#logit"><i class="fa fa-check"></i><b>5.2.1</b> Logit<span></span></a></li>
<li class="chapter" data-level="5.2.2" data-path="models-of-binary-outcomes.html"><a href="models-of-binary-outcomes.html#probit"><i class="fa fa-check"></i><b>5.2.2</b> Probit<span></span></a></li>
<li class="chapter" data-level="5.2.3" data-path="models-of-binary-outcomes.html"><a href="models-of-binary-outcomes.html#cloglog"><i class="fa fa-check"></i><b>5.2.3</b> Cloglog<span></span></a></li>
<li class="chapter" data-level="5.2.4" data-path="models-of-binary-outcomes.html"><a href="models-of-binary-outcomes.html#cauchit"><i class="fa fa-check"></i><b>5.2.4</b> Cauchit<span></span></a></li>
<li class="chapter" data-level="5.2.5" data-path="models-of-binary-outcomes.html"><a href="models-of-binary-outcomes.html#scobit"><i class="fa fa-check"></i><b>5.2.5</b> Scobit<span></span></a></li>
<li class="chapter" data-level="5.2.6" data-path="models-of-binary-outcomes.html"><a href="models-of-binary-outcomes.html#heteroskedastic-probit"><i class="fa fa-check"></i><b>5.2.6</b> Heteroskedastic Probit<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="week-6-an-explosion-of-quantities-of-interest.html"><a href="week-6-an-explosion-of-quantities-of-interest.html"><i class="fa fa-check"></i><b>6</b> Week 6: An Explosion of Quantities of Interest<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="king-tomz-and-wittenberg-2001.html"><a href="king-tomz-and-wittenberg-2001.html"><i class="fa fa-check"></i><b>6.1</b> King, Tomz, and Wittenberg (2001)<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="brambor-clark-and-golder-2006.html"><a href="brambor-clark-and-golder-2006.html"><i class="fa fa-check"></i><b>6.2</b> Brambor, Clark, and Golder (2006)<span></span></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="brambor-clark-and-golder-2006.html"><a href="brambor-clark-and-golder-2006.html#a-warning-about-misinterpreting-marginal-effect-plots"><i class="fa fa-check"></i><b>6.2.1</b> A Warning about Misinterpreting Marginal Effect Plots<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="berry-golder-and-milton-2012.html"><a href="berry-golder-and-milton-2012.html"><i class="fa fa-check"></i><b>6.3</b> Berry, Golder, and Milton (2012)<span></span></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Modeling: A Tools Approach</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="models-of-binary-outcomes" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Models of Binary Outcomes<a href="models-of-binary-outcomes.html#models-of-binary-outcomes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here, I describe a diverse collection of models of binary outcomes.</p>
<div id="logit" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Logit<a href="models-of-binary-outcomes.html#logit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math display">\[
y_i \sim \text{Bernoulli}(\pi_i), \text{ where } \pi_i = \text{logit}^{-1}(X_i\beta) \text{ and } \text{logit}^{-1}(x) = \frac{e^x}{1 + e^x}
\]</span></p>
<table>
<colgroup>
<col width="17%" />
<col width="82%" />
</colgroup>
<thead>
<tr class="header">
<th>Quantity</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Distribution</td>
<td><span class="math inline">\(y_i \sim \text{Bernoulli}(\pi_i)\)</span></td>
</tr>
<tr class="even">
<td>Inverse Link Function</td>
<td><span class="math inline">\(\pi_i = \text{logit}^{-1}(X_i\beta) = \frac{e^{X_i\beta}}{1 + e^{X_i\beta}}\)</span></td>
</tr>
<tr class="odd">
<td>Fit Syntax</td>
<td><code>glm(formula, data, family = binomial()</code></td>
</tr>
<tr class="even">
<td>Expected Value</td>
<td><span class="math inline">\(\hat{E}(\tilde{y} \mid X_s) = \hat{\pi}_s = \text{logit}^{-1}(X_s\hat{\beta})\)</span></td>
</tr>
<tr class="odd">
<td>Manual Computation of EV</td>
<td><code>pi_s = plogis(X_s %*% beta_hat)</code></td>
</tr>
<tr class="even">
<td><code>predict()</code> Computation of EV</td>
<td><code>pi_s = predict(fit, newdata = X_s, type = "response")</code></td>
</tr>
<tr class="odd">
<td>Marginal Effect</td>
<td><span class="math inline">\(\frac{ \partial \hat{E}(\tilde{y} \mid X_s)}{\partial x_j} = \hat{\beta}_j\hat{\pi}_s(1 - \hat{\pi}_s)\)</span></td>
</tr>
<tr class="even">
<td>Computation of Marginal Effect</td>
<td><code>coef(fit)*p_s*(1 - p_s)</code></td>
</tr>
</tbody>
</table>
<p>Note: the marginal effect above assumes that <span class="math inline">\(x_j\)</span> is included in the model <em>linearly</em> with no polynomial or interactions.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="models-of-binary-outcomes.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load nagler&#39;s scobit data</span></span>
<span id="cb270-2"><a href="models-of-binary-outcomes.html#cb270-2" aria-hidden="true" tabindex="-1"></a>scobit <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="st">&quot;data/scobit.dta&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb270-3"><a href="models-of-binary-outcomes.html#cb270-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(newvote <span class="sc">!=</span> <span class="sc">-</span><span class="dv">1</span>)  <span class="co"># weird -1s in data; unsure if sufficient</span></span>
<span id="cb270-4"><a href="models-of-binary-outcomes.html#cb270-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-5"><a href="models-of-binary-outcomes.html#cb270-5" aria-hidden="true" tabindex="-1"></a><span class="co"># simplest model specification; no polynomials or interactions</span></span>
<span id="cb270-6"><a href="models-of-binary-outcomes.html#cb270-6" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> newvote <span class="sc">~</span> neweduc <span class="sc">+</span> closing <span class="sc">+</span> age <span class="sc">+</span> south <span class="sc">+</span> gov</span>
<span id="cb270-7"><a href="models-of-binary-outcomes.html#cb270-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-8"><a href="models-of-binary-outcomes.html#cb270-8" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb270-9"><a href="models-of-binary-outcomes.html#cb270-9" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(f, <span class="at">data =</span> scobit, <span class="at">family =</span> <span class="fu">binomial</span>())</span></code></pre></div>
<p>Now let’s compute quantities of interest. Let’s first compute the expected value or “predicted probability” as <code>closing</code> varies from zero to 50 with all other variables at their medians.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="models-of-binary-outcomes.html#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let education vary across all possible values; else median</span></span>
<span id="cb271-2"><a href="models-of-binary-outcomes.html#cb271-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb271-3"><a href="models-of-binary-outcomes.html#cb271-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">neweduc =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,</span>
<span id="cb271-4"><a href="models-of-binary-outcomes.html#cb271-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">closing =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>closing),</span>
<span id="cb271-5"><a href="models-of-binary-outcomes.html#cb271-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>age),</span>
<span id="cb271-6"><a href="models-of-binary-outcomes.html#cb271-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">south =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>south),</span>
<span id="cb271-7"><a href="models-of-binary-outcomes.html#cb271-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">gov =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>gov)</span>
<span id="cb271-8"><a href="models-of-binary-outcomes.html#cb271-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb271-9"><a href="models-of-binary-outcomes.html#cb271-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-10"><a href="models-of-binary-outcomes.html#cb271-10" aria-hidden="true" tabindex="-1"></a><span class="co"># expected value or &quot;predicted probability&quot; </span></span>
<span id="cb271-11"><a href="models-of-binary-outcomes.html#cb271-11" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>expected_value <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> s, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb271-12"><a href="models-of-binary-outcomes.html#cb271-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-13"><a href="models-of-binary-outcomes.html#cb271-13" aria-hidden="true" tabindex="-1"></a><span class="co"># marginal effect of closing on expected value</span></span>
<span id="cb271-14"><a href="models-of-binary-outcomes.html#cb271-14" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>marginal_effect <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit)[<span class="st">&quot;neweduc&quot;</span>]<span class="sc">*</span>s<span class="sc">$</span>expected_value<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>s<span class="sc">$</span>expected_value)</span></code></pre></div>
<p>Now let’s make a plot of the expected values and marginal effects.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="models-of-binary-outcomes.html#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb272-2"><a href="models-of-binary-outcomes.html#cb272-2" aria-hidden="true" tabindex="-1"></a>gg1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(s, <span class="fu">aes</span>(<span class="at">x =</span> neweduc, <span class="at">y =</span> expected_value)) <span class="sc">+</span> </span>
<span id="cb272-3"><a href="models-of-binary-outcomes.html#cb272-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb272-4"><a href="models-of-binary-outcomes.html#cb272-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb272-5"><a href="models-of-binary-outcomes.html#cb272-5" aria-hidden="true" tabindex="-1"></a>gg2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(s, <span class="fu">aes</span>(<span class="at">x =</span> neweduc, <span class="at">y =</span> marginal_effect)) <span class="sc">+</span> </span>
<span id="cb272-6"><a href="models-of-binary-outcomes.html#cb272-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb272-7"><a href="models-of-binary-outcomes.html#cb272-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb272-8"><a href="models-of-binary-outcomes.html#cb272-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-9"><a href="models-of-binary-outcomes.html#cb272-9" aria-hidden="true" tabindex="-1"></a><span class="co"># combine plots and print</span></span>
<span id="cb272-10"><a href="models-of-binary-outcomes.html#cb272-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb272-11"><a href="models-of-binary-outcomes.html#cb272-11" aria-hidden="true" tabindex="-1"></a>gg1 <span class="sc">+</span> gg2</span></code></pre></div>
<p><img src="05-02-models-of-binary-outcomes_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>For this model, let’s briefly consider the <em>other</em> predictors in the model. In particular, let’s reproduce the figure above, but for every combination of the other covariates that appeared in the data set. (It turns out the <em>every</em> combination was overwhelming, so I used a sample of 100 other scenarios from the exhaustive list).</p>
<p>You can see that as the <em>other</em> covariates change, the expected value changes. But more importantly, the maginal effect of education changes as the other covariates change. That’s why it’s <em>critical</em> to develop an appropriate scenario that specifies values for <em>all</em> the covariates in the model.</p>
<p><img src="05-02-models-of-binary-outcomes_files/figure-html/unnamed-chunk-5-1.png" width="672" />
Lastly, before we proceed to the next model, I’m going to save the expected values and marginal effects that I computed for the logit model to compare to the other models we discuss.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="models-of-binary-outcomes.html#cb273-1" aria-hidden="true" tabindex="-1"></a>s_logit <span class="ot">&lt;-</span> s     <span class="co"># estimates of ev and me from logit model</span></span>
<span id="cb273-2"><a href="models-of-binary-outcomes.html#cb273-2" aria-hidden="true" tabindex="-1"></a>fit_logit <span class="ot">&lt;-</span> fit <span class="co"># logit model fit</span></span></code></pre></div>
</div>
<div id="probit" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Probit<a href="models-of-binary-outcomes.html#probit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The probit model replaced the CDF of the standard logistic distribution with the CDF of the standard normal distribution. Rather than the “inverse logit” inverse link function, we use the CDF of the standard normal distrubtion.</p>
<table>
<colgroup>
<col width="17%" />
<col width="82%" />
</colgroup>
<thead>
<tr class="header">
<th>Quantity</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Distribution</td>
<td><span class="math inline">\(y_i \sim \text{Bernoulli}(\pi_i)\)</span></td>
</tr>
<tr class="even">
<td>Inverse Link Function</td>
<td><span class="math inline">\(\pi_i = \Phi(X_i\beta)\)</span>, where <span class="math inline">\(\Phi()\)</span> is the PDF of the standard normal distributio</td>
</tr>
<tr class="odd">
<td>Fit Syntax</td>
<td><code>glm(formula, data, family = binomial(link = "probit")</code></td>
</tr>
<tr class="even">
<td>Expected Value</td>
<td><span class="math inline">\(\hat{E}(\tilde{y} \mid X_s) = \hat{\pi}_s = \Phi(X_s\hat{\beta})\)</span></td>
</tr>
<tr class="odd">
<td>Manual Computation of EV</td>
<td><code>pi_s = pnorm(X_s %*% beta_hat)</code></td>
</tr>
<tr class="even">
<td><code>predict()</code> Computation of EV</td>
<td><code>pi_s = predict(fit, newdata = X_s, type = "response")</code></td>
</tr>
<tr class="odd">
<td>Marginal Effect</td>
<td><span class="math inline">\(\frac{ \partial \hat{E}(\tilde{y} \mid X_s)}{\partial x_j} = \phi(X\hat{\beta}) \hat{\beta}_j\)</span>, where <span class="math inline">\(\phi()\)</span> is the PDF of the standard normal distribution</td>
</tr>
<tr class="even">
<td>Computation of Marginal Effect</td>
<td><code>dnorm(predict(fit, newdata = X_s, type = "link"))*coef(fit)[j]</code></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="models-of-binary-outcomes.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb274-2"><a href="models-of-binary-outcomes.html#cb274-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(f, <span class="at">data =</span> scobit, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;probit&quot;</span>))</span></code></pre></div>
<p>Now let’s compute quantities of interest. Let’s first compute the expected value or “predicted probability” as <code>neweduc</code> varies from 1 to 8 (all possible values) with all other variables at their medians.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="models-of-binary-outcomes.html#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let education vary across all possible values; else median</span></span>
<span id="cb275-2"><a href="models-of-binary-outcomes.html#cb275-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb275-3"><a href="models-of-binary-outcomes.html#cb275-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">neweduc =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,</span>
<span id="cb275-4"><a href="models-of-binary-outcomes.html#cb275-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">closing =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>closing),</span>
<span id="cb275-5"><a href="models-of-binary-outcomes.html#cb275-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>age),</span>
<span id="cb275-6"><a href="models-of-binary-outcomes.html#cb275-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">south =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>south),</span>
<span id="cb275-7"><a href="models-of-binary-outcomes.html#cb275-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">gov =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>gov)</span>
<span id="cb275-8"><a href="models-of-binary-outcomes.html#cb275-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb275-9"><a href="models-of-binary-outcomes.html#cb275-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-10"><a href="models-of-binary-outcomes.html#cb275-10" aria-hidden="true" tabindex="-1"></a><span class="co"># expected value or &quot;predicted probability&quot; </span></span>
<span id="cb275-11"><a href="models-of-binary-outcomes.html#cb275-11" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>expected_value <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> s, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb275-12"><a href="models-of-binary-outcomes.html#cb275-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-13"><a href="models-of-binary-outcomes.html#cb275-13" aria-hidden="true" tabindex="-1"></a><span class="co"># marginal effect of closing on expected value</span></span>
<span id="cb275-14"><a href="models-of-binary-outcomes.html#cb275-14" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>linpred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> s, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>)</span>
<span id="cb275-15"><a href="models-of-binary-outcomes.html#cb275-15" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>marginal_effect <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit)[<span class="st">&quot;neweduc&quot;</span>]<span class="sc">*</span><span class="fu">dnorm</span>(s<span class="sc">$</span>linpred)</span></code></pre></div>
<p>Now let’s make a plot of the expected values and marginal effects. The grey lines show the orginal logit estimates.</p>
<p><img src="05-02-models-of-binary-outcomes_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="models-of-binary-outcomes.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit, fit_logit) <span class="sc">%&gt;%</span></span>
<span id="cb276-2"><a href="models-of-binary-outcomes.html#cb276-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_min =</span> <span class="fu">min</span>(AIC) <span class="sc">-</span> AIC, </span>
<span id="cb276-3"><a href="models-of-binary-outcomes.html#cb276-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">rel_lik =</span> <span class="fu">exp</span>(diff_min<span class="sc">/</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>##           df      AIC  diff_min      rel_lik
## fit        6 113111.1 -182.1109 2.851781e-40
## fit_logit  6 112929.0    0.0000 1.000000e+00</code></pre>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="models-of-binary-outcomes.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(fit, fit_logit)</span></code></pre></div>
<pre><code>##           df      BIC
## fit        6 113168.2
## fit_logit  6 112986.1</code></pre>
</div>
<div id="cloglog" class="section level3 hasAnchor" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Cloglog<a href="models-of-binary-outcomes.html#cloglog" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<table>
<colgroup>
<col width="17%" />
<col width="82%" />
</colgroup>
<thead>
<tr class="header">
<th>Quantity</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Distribution</td>
<td><span class="math inline">\(y_i \sim \text{Bernoulli}(\pi_i)\)</span> distribution</td>
</tr>
<tr class="even">
<td>Inverse Link Function</td>
<td><span class="math inline">\(\pi_i = 1 - e^{-e^{X_i\beta}}\)</span></td>
</tr>
<tr class="odd">
<td>Fit Syntax</td>
<td><code>glm(formula, data, family = binomial(link = "cloglog")</code></td>
</tr>
<tr class="even">
<td>Expected Value</td>
<td><span class="math inline">\(\hat{E}(\tilde{y} \mid X_s) = \hat{\pi}_s = 1 - e^{-e^{X_s\beta}}\)</span></td>
</tr>
<tr class="odd">
<td>Manual Computation of EV</td>
<td><code>pi_s = 1 - exp(-exp(X_s %*% beta_hat))</code></td>
</tr>
<tr class="even">
<td><code>predict()</code> Computation of EV</td>
<td><code>pi_s = predict(fit, newdata = X_s, type = "response")</code></td>
</tr>
<tr class="odd">
<td>Marginal Effect</td>
<td><span class="math inline">\(\frac{ \partial \hat{E}(\tilde{y} \mid X_s)}{\partial x_j} = e^{-e^{X\hat{\beta}}}e^{X\hat{\beta}}\hat{\beta}_j\)</span></td>
</tr>
<tr class="even">
<td>Computation of Marginal Effect</td>
<td><code>exp(-exp(linpred))*exp(linpred)*coef(fit)[j]</code>, where <code>linpred &lt;- predict(fit, newdata = X_s, type = "link")</code></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="models-of-binary-outcomes.html#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb280-2"><a href="models-of-binary-outcomes.html#cb280-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(f, <span class="at">data =</span> scobit, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;cloglog&quot;</span>))</span></code></pre></div>
<p>Now let’s compute quantities of interest. Let’s first compute the expected value or “predicted probability” as <code>neweduc</code> varies from 1 to 8 (all possible values) with all other variables at their medians.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="models-of-binary-outcomes.html#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let education vary across all possible values; else median</span></span>
<span id="cb281-2"><a href="models-of-binary-outcomes.html#cb281-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb281-3"><a href="models-of-binary-outcomes.html#cb281-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">neweduc =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,</span>
<span id="cb281-4"><a href="models-of-binary-outcomes.html#cb281-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">closing =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>closing),</span>
<span id="cb281-5"><a href="models-of-binary-outcomes.html#cb281-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>age),</span>
<span id="cb281-6"><a href="models-of-binary-outcomes.html#cb281-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">south =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>south),</span>
<span id="cb281-7"><a href="models-of-binary-outcomes.html#cb281-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">gov =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>gov)</span>
<span id="cb281-8"><a href="models-of-binary-outcomes.html#cb281-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb281-9"><a href="models-of-binary-outcomes.html#cb281-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-10"><a href="models-of-binary-outcomes.html#cb281-10" aria-hidden="true" tabindex="-1"></a><span class="co"># expected value or &quot;predicted probability&quot; </span></span>
<span id="cb281-11"><a href="models-of-binary-outcomes.html#cb281-11" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>expected_value <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> s, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb281-12"><a href="models-of-binary-outcomes.html#cb281-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-13"><a href="models-of-binary-outcomes.html#cb281-13" aria-hidden="true" tabindex="-1"></a><span class="co"># marginal effect of closing on expected value</span></span>
<span id="cb281-14"><a href="models-of-binary-outcomes.html#cb281-14" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>linpred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> s, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>)</span>
<span id="cb281-15"><a href="models-of-binary-outcomes.html#cb281-15" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>marginal_effect <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">exp</span>(s<span class="sc">$</span>linpred))<span class="sc">*</span><span class="fu">exp</span>(s<span class="sc">$</span>linpred)<span class="sc">*</span><span class="fu">coef</span>(fit)[<span class="st">&quot;neweduc&quot;</span>]</span></code></pre></div>
<p>Now let’s make a plot of the expected values and marginal effects. The grey lines show the orginial logit estimates.</p>
<p>Importantly, the cloglog model is not symmetric (like logit and probit) around 0.5.</p>
<p><img src="05-02-models-of-binary-outcomes_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="models-of-binary-outcomes.html#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit, fit_logit) <span class="sc">%&gt;%</span></span>
<span id="cb282-2"><a href="models-of-binary-outcomes.html#cb282-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_min =</span> AIC <span class="sc">-</span> <span class="fu">min</span>(AIC),</span>
<span id="cb282-3"><a href="models-of-binary-outcomes.html#cb282-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">akiaike_weights =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>diff_min)<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>diff_min)))</span></code></pre></div>
<pre><code>##           df    AIC diff_min akiaike_weights
## fit        6 113664 734.9586   2.545478e-160
## fit_logit  6 112929   0.0000    1.000000e+00</code></pre>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="models-of-binary-outcomes.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(fit, fit_logit) <span class="sc">%&gt;%</span></span>
<span id="cb284-2"><a href="models-of-binary-outcomes.html#cb284-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_min =</span> BIC <span class="sc">-</span> <span class="fu">min</span>(BIC),</span>
<span id="cb284-3"><a href="models-of-binary-outcomes.html#cb284-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">post_prob =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>diff_min)<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>diff_min)))</span></code></pre></div>
<pre><code>##           df      BIC diff_min     post_prob
## fit        6 113721.0 734.9586 2.545478e-160
## fit_logit  6 112986.1   0.0000  1.000000e+00</code></pre>
</div>
<div id="cauchit" class="section level3 hasAnchor" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Cauchit<a href="models-of-binary-outcomes.html#cauchit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Like the probit uses the normal CDF as the inverse link function, the cauchit uses the Cauchy CDF. Why logit and probit are similar, there is a meaningful difference between the logit and cauchit. Because the Cauchy has heavier tails that the logistic and normal distributions, it behaves more linearly</p>
<table>
<colgroup>
<col width="17%" />
<col width="82%" />
</colgroup>
<thead>
<tr class="header">
<th>Quantity</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Distribution</td>
<td><span class="math inline">\(y_i \sim \text{Bernoulli}(\pi_i)\)</span> distribution</td>
</tr>
<tr class="even">
<td>Inverse Link Function</td>
<td><span class="math inline">\(\pi_i = \frac{1}{\pi}\text{arctan} (X_i\beta) + \frac{1}{2} = F_{Cauchy}(X_i\beta)\)</span>.</td>
</tr>
<tr class="odd">
<td>Fit Syntax</td>
<td><code>glm(formula, data, family = binomial(link = "cauchit")</code></td>
</tr>
<tr class="even">
<td>Expected Value</td>
<td><span class="math inline">\(\hat{E}(\tilde{y} \mid X_s) = \hat{\pi}_s = \frac{1}{\pi}\text{arctan} (X_s\beta) + \frac{1}{2}\)</span></td>
</tr>
<tr class="odd">
<td>Manual Computation of EV</td>
<td><code>pi_s = (1/pi)*atan(X_s %*% beta_hat) + 0.5</code> (Make sure you haven’t redefined <code>pi</code>!)</td>
</tr>
<tr class="even">
<td><code>predict()</code> Computation of EV</td>
<td><code>pi_s = predict(fit, newdata = X_s, type = "response")</code></td>
</tr>
<tr class="odd">
<td>Marginal Effect</td>
<td><span class="math inline">\(\frac{ \partial \hat{E}(\tilde{y} \mid X_s)}{\partial x_j} = \pi\left[ 1 + (X_s\hat{\beta})^2 \right] \hat{\beta}_j = f_{\text{Cauchy}}(X_s\hat{\beta})\hat{\beta}_j\)</span></td>
</tr>
<tr class="even">
<td>Computation of Marginal Effect</td>
<td><code>dcauchy(linpred)*(coef(fit)[j]</code>, where <code>linpred &lt;- predict(fit, newdata = X_s, type = "link")</code></td>
</tr>
</tbody>
</table>
<p>To illustrate the tail behavior of the logit and cauchit model, I simulated a data set using the true cauchit model, and fitted the logit and cauchit models.</p>
<ol style="list-style-type: decimal">
<li>The logit curve <em>smoothly</em> transitions from flat to steep to flat again.</li>
<li>The cauchit model seems to have three distinct sections a roughly linear portion below <span class="math inline">\(\pi = 0.15\)</span>, another roughly linear portion between between 0.25 and 0.75, and another roughly linear portion above about 0.85. Between these roughly linear portions, the curve changes slope changes dramatically.</li>
</ol>
<p><img src="05-02-models-of-binary-outcomes_files/figure-html/unnamed-chunk-15-1.png" width="768" /></p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="models-of-binary-outcomes.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb286-2"><a href="models-of-binary-outcomes.html#cb286-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(f, <span class="at">data =</span> scobit, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;cauchit&quot;</span>))</span></code></pre></div>
<p>Now let’s compute quantities of interest. Let’s first compute the expected value or “predicted probability” as <code>neweduc</code> varies from 1 to 8 (all possible values) with all other variables at their medians.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="models-of-binary-outcomes.html#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let education vary across all possible values; else median</span></span>
<span id="cb287-2"><a href="models-of-binary-outcomes.html#cb287-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb287-3"><a href="models-of-binary-outcomes.html#cb287-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">neweduc =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,</span>
<span id="cb287-4"><a href="models-of-binary-outcomes.html#cb287-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">closing =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>closing),</span>
<span id="cb287-5"><a href="models-of-binary-outcomes.html#cb287-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>age),</span>
<span id="cb287-6"><a href="models-of-binary-outcomes.html#cb287-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">south =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>south),</span>
<span id="cb287-7"><a href="models-of-binary-outcomes.html#cb287-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">gov =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>gov)</span>
<span id="cb287-8"><a href="models-of-binary-outcomes.html#cb287-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb287-9"><a href="models-of-binary-outcomes.html#cb287-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-10"><a href="models-of-binary-outcomes.html#cb287-10" aria-hidden="true" tabindex="-1"></a><span class="co"># expected value or &quot;predicted probability&quot; </span></span>
<span id="cb287-11"><a href="models-of-binary-outcomes.html#cb287-11" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>expected_value <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> s, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb287-12"><a href="models-of-binary-outcomes.html#cb287-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-13"><a href="models-of-binary-outcomes.html#cb287-13" aria-hidden="true" tabindex="-1"></a><span class="co"># marginal effect of closing on expected value</span></span>
<span id="cb287-14"><a href="models-of-binary-outcomes.html#cb287-14" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>linpred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> s, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>)</span>
<span id="cb287-15"><a href="models-of-binary-outcomes.html#cb287-15" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>marginal_effect <span class="ot">&lt;-</span> <span class="fu">dcauchy</span>(s<span class="sc">$</span>linpred)<span class="sc">*</span><span class="fu">coef</span>(fit)[<span class="st">&quot;neweduc&quot;</span>]</span></code></pre></div>
<p>Now let’s make a plot of the expected values and marginal effects. The grey lines show the orginial logit estimates.</p>
<p><img src="05-02-models-of-binary-outcomes_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="models-of-binary-outcomes.html#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit, fit_logit) <span class="sc">%&gt;%</span></span>
<span id="cb288-2"><a href="models-of-binary-outcomes.html#cb288-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_min =</span> AIC <span class="sc">-</span> <span class="fu">min</span>(AIC),</span>
<span id="cb288-3"><a href="models-of-binary-outcomes.html#cb288-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">akiaike_weights =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>diff_min)<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>diff_min)))</span></code></pre></div>
<pre><code>##           df      AIC diff_min akiaike_weights
## fit        6 112650.1   0.0000    1.000000e+00
## fit_logit  6 112929.0 278.9223    2.708833e-61</code></pre>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="models-of-binary-outcomes.html#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(fit, fit_logit) <span class="sc">%&gt;%</span></span>
<span id="cb290-2"><a href="models-of-binary-outcomes.html#cb290-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_min =</span> BIC <span class="sc">-</span> <span class="fu">min</span>(BIC),</span>
<span id="cb290-3"><a href="models-of-binary-outcomes.html#cb290-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">post_prob =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>diff_min)<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>diff_min)))</span></code></pre></div>
<pre><code>##           df      BIC diff_min    post_prob
## fit        6 112707.1   0.0000 1.000000e+00
## fit_logit  6 112986.1 278.9223 2.708833e-61</code></pre>
</div>
<div id="scobit" class="section level3 hasAnchor" number="5.2.5">
<h3><span class="header-section-number">5.2.5</span> Scobit<a href="models-of-binary-outcomes.html#scobit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Nagler (1994) argues that we should consider relaxing the assumption that the marginal effect <span class="math inline">\(\frac{ \partial \hat{E}(\tilde{y} \mid X_s)}{\partial x_j}\)</span> is maximized at <span class="math inline">\(\hat{E}(\tilde{y} \mid X_s) = 0.5\)</span> and instead estimate a more general function that allows the point where the marginal effect is maximized to be <em>estimated</em> from the data.</p>
<p>While the logit model uses the inverse link function <span class="math inline">\(\pi_i = \frac{1}{ 1 + e^{-X_i\beta}}\)</span>, the scobit model uses the inverse link function <span class="math inline">\(\pi_i = \frac{1}{\left[ 1 + e^{-X_i\beta}\right]^\alpha}\)</span>.</p>
<p>You can read more about Nagler’s Scobit model in is 1994 <em>AJPS</em> <a href="https://www.jstor.org/stable/2111343">article</a>.</p>
<table>
<colgroup>
<col width="17%" />
<col width="82%" />
</colgroup>
<thead>
<tr class="header">
<th>Quantity</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Distribution</td>
<td><span class="math inline">\(y_i \sim \text{Bernoulli}(\pi_i)\)</span> distribution</td>
</tr>
<tr class="even">
<td>Inverse Link Function</td>
<td><span class="math inline">\(\pi_i = \frac{1}{\left[ 1 + e^{-X_i\beta}\right]^\alpha}\)</span></td>
</tr>
<tr class="odd">
<td>Fit Syntax</td>
<td>None. I do not recommend ML. This model is difficult, so I recommend MCMC and weakly informative priors.</td>
</tr>
<tr class="even">
<td>Expected Value</td>
<td><span class="math inline">\(\hat{E}(\tilde{y} \mid X_s) = \frac{1}{\left[ 1 + e^{-X_s\hat{\beta}} \right]^\hat{\alpha}}\)</span></td>
</tr>
<tr class="odd">
<td>Manual Computation of EV</td>
<td><code>pi_s = 1/((1 + exp(-X_s %*% beta_hat))^alpha_hat)</code></td>
</tr>
<tr class="even">
<td><code>predict()</code> Computation of EV</td>
<td>None; use generated quantities block in Stan or manual post-processing of posterior simulations.</td>
</tr>
<tr class="odd">
<td>Marginal Effect</td>
<td><span class="math inline">\(\frac{ \partial \hat{E}(\tilde{y} \mid X_s)}{\partial x_j} = \hat{\alpha} [1 + e^{-X\hat{\beta}}][e^{-X\hat{\beta}}]\hat{\beta}_j\)</span></td>
</tr>
<tr class="even">
<td>Computation of Marginal Effect</td>
<td>Use generated quantities block in Stan or manual post-processing of posterior simulations.</td>
</tr>
</tbody>
</table>
<p>These models are notoriously difficult to estimate. Fortunately, we’ve got very good MCMC algorithms to deal with difficult likelihoods. If you <em>must</em> fit this model, you should fit it with Stan and be extra careful.</p>
<p>I’ve tried fitting this lots of different ways and not had much success. I suggest using Stan’s sampling algorithm (or perhaps its optimization routine) and using a fairly strong prior around <span class="math inline">\(\alpha\)</span> to keep it near 1.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb292-1"><a href="models-of-binary-outcomes.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb292-2"><a href="models-of-binary-outcomes.html#cb292-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;   <span class="co">// number of data items</span></span>
<span id="cb292-3"><a href="models-of-binary-outcomes.html#cb292-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; K;   <span class="co">// number of predictors</span></span>
<span id="cb292-4"><a href="models-of-binary-outcomes.html#cb292-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[N, K] X;   <span class="co">// predictor matrix</span></span>
<span id="cb292-5"><a href="models-of-binary-outcomes.html#cb292-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> y[N];      <span class="co">// outcome vector</span></span>
<span id="cb292-6"><a href="models-of-binary-outcomes.html#cb292-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb292-7"><a href="models-of-binary-outcomes.html#cb292-7" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb292-8"><a href="models-of-binary-outcomes.html#cb292-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[K] beta;       <span class="co">// coefficients for X</span></span>
<span id="cb292-9"><a href="models-of-binary-outcomes.html#cb292-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; alpha;  <span class="co">// nagler&#39;s shape parameter</span></span>
<span id="cb292-10"><a href="models-of-binary-outcomes.html#cb292-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb292-11"><a href="models-of-binary-outcomes.html#cb292-11" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed parameters</span> {</span>
<span id="cb292-12"><a href="models-of-binary-outcomes.html#cb292-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] pi;</span>
<span id="cb292-13"><a href="models-of-binary-outcomes.html#cb292-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] linpred;</span>
<span id="cb292-14"><a href="models-of-binary-outcomes.html#cb292-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb292-15"><a href="models-of-binary-outcomes.html#cb292-15" aria-hidden="true" tabindex="-1"></a>    linpred[i] = X[i, ]*beta;</span>
<span id="cb292-16"><a href="models-of-binary-outcomes.html#cb292-16" aria-hidden="true" tabindex="-1"></a>    pi[i] = <span class="dv">1</span>/pow((<span class="dv">1</span> + exp(-(X[i, ]*beta))), alpha);</span>
<span id="cb292-17"><a href="models-of-binary-outcomes.html#cb292-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb292-18"><a href="models-of-binary-outcomes.html#cb292-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb292-19"><a href="models-of-binary-outcomes.html#cb292-19" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb292-20"><a href="models-of-binary-outcomes.html#cb292-20" aria-hidden="true" tabindex="-1"></a>  alpha ~ gamma(<span class="dv">6</span>, <span class="dv">5</span>);  <span class="co">// alpha is &quot;near&quot; one; mode of gamma is (a - 1)/b; sd is sqrt(a)/b</span></span>
<span id="cb292-21"><a href="models-of-binary-outcomes.html#cb292-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">//beta ~ cauchy(0, 10);     // weakly informative prior to rule out very large and small values</span></span>
<span id="cb292-22"><a href="models-of-binary-outcomes.html#cb292-22" aria-hidden="true" tabindex="-1"></a>  y ~ bernoulli(pi);  <span class="co">// likelihood</span></span>
<span id="cb292-23"><a href="models-of-binary-outcomes.html#cb292-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="models-of-binary-outcomes.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain the model matrix X</span></span>
<span id="cb293-2"><a href="models-of-binary-outcomes.html#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb293-3"><a href="models-of-binary-outcomes.html#cb293-3" aria-hidden="true" tabindex="-1"></a>scobit_small <span class="ot">=</span> <span class="fu">sample_n</span>(scobit, <span class="dv">1000</span>)  <span class="co"># small sample to save time</span></span>
<span id="cb293-4"><a href="models-of-binary-outcomes.html#cb293-4" aria-hidden="true" tabindex="-1"></a>mf <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(f, <span class="at">data =</span> scobit_small)  <span class="co"># model frame</span></span>
<span id="cb293-5"><a href="models-of-binary-outcomes.html#cb293-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(f, mf)         <span class="co"># model matrix X</span></span>
<span id="cb293-6"><a href="models-of-binary-outcomes.html#cb293-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-7"><a href="models-of-binary-outcomes.html#cb293-7" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain the outcome variable y</span></span>
<span id="cb293-8"><a href="models-of-binary-outcomes.html#cb293-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">model.response</span>(mf)</span>
<span id="cb293-9"><a href="models-of-binary-outcomes.html#cb293-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-10"><a href="models-of-binary-outcomes.html#cb293-10" aria-hidden="true" tabindex="-1"></a><span class="co"># fit stan model</span></span>
<span id="cb293-11"><a href="models-of-binary-outcomes.html#cb293-11" aria-hidden="true" tabindex="-1"></a>stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> y, <span class="at">X =</span> X, <span class="at">N =</span> <span class="fu">nrow</span>(X), <span class="at">K =</span> <span class="fu">ncol</span>(X))</span>
<span id="cb293-12"><a href="models-of-binary-outcomes.html#cb293-12" aria-hidden="true" tabindex="-1"></a>stan_opt <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">optimizing</span>(scobit_model, <span class="at">data =</span> stan_data, </span>
<span id="cb293-13"><a href="models-of-binary-outcomes.html#cb293-13" aria-hidden="true" tabindex="-1"></a>                              <span class="at">algorithm =</span> <span class="st">&quot;Newton&quot;</span>)</span>
<span id="cb293-14"><a href="models-of-binary-outcomes.html#cb293-14" aria-hidden="true" tabindex="-1"></a>stan_samp <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">sampling</span>(scobit_model, <span class="at">data =</span> stan_data,</span>
<span id="cb293-15"><a href="models-of-binary-outcomes.html#cb293-15" aria-hidden="true" tabindex="-1"></a>                            <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;beta&quot;</span>, <span class="st">&quot;alpha&quot;</span>),</span>
<span id="cb293-16"><a href="models-of-binary-outcomes.html#cb293-16" aria-hidden="true" tabindex="-1"></a>                            <span class="at">cores =</span> <span class="dv">3</span>,</span>
<span id="cb293-17"><a href="models-of-binary-outcomes.html#cb293-17" aria-hidden="true" tabindex="-1"></a>                            <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb293-18"><a href="models-of-binary-outcomes.html#cb293-18" aria-hidden="true" tabindex="-1"></a>                            <span class="at">iter =</span> <span class="dv">2000</span>)</span></code></pre></div>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="models-of-binary-outcomes.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ML results from stan optimization of scobit</span></span>
<span id="cb294-2"><a href="models-of-binary-outcomes.html#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(stan_opt<span class="sc">$</span>par[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>])</span></code></pre></div>
<pre><code>## beta[1] beta[2] beta[3] beta[4] beta[5] beta[6]   alpha 
##       0       0       0       0       0       0       1</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="models-of-binary-outcomes.html#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ML results from glm() logit </span></span>
<span id="cb296-2"><a href="models-of-binary-outcomes.html#cb296-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">glm</span>(f, <span class="at">data =</span> scobit_small, <span class="at">family =</span> binomial))</span></code></pre></div>
<pre><code>## (Intercept)     neweduc     closing         age       south         gov 
## -4.04393179  0.62708977 -0.02039651  0.04715321 -0.27764434  0.01848814</code></pre>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="models-of-binary-outcomes.html#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary of stan mcmc samples</span></span>
<span id="cb298-2"><a href="models-of-binary-outcomes.html#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(stan_samp)</span></code></pre></div>
<pre><code>## Inference for Stan model: 2ea053ffa7101a65d510af4b2cb5978b.
## 3 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=3000.
## 
##            mean se_mean   sd    2.5%     25%     50%     75%   97.5% n_eff Rhat
## beta[1]   -3.74    0.04 0.98   -5.98   -4.31   -3.61   -3.06   -2.17   619    1
## beta[2]    0.62    0.00 0.08    0.48    0.56    0.61    0.66    0.80   745    1
## beta[3]   -0.02    0.00 0.01   -0.04   -0.03   -0.02   -0.02   -0.01  2219    1
## beta[4]    0.05    0.00 0.01    0.04    0.04    0.05    0.05    0.06   910    1
## beta[5]   -0.27    0.00 0.18   -0.62   -0.38   -0.26   -0.15    0.08  1836    1
## beta[6]    0.02    0.00 0.20   -0.38   -0.12    0.02    0.16    0.41  2150    1
## alpha      1.30    0.02 0.48    0.56    0.95    1.24    1.58    2.40   942    1
## lp__    -561.24    0.07 2.09 -566.24 -562.31 -560.91 -559.75 -558.31   813    1
## 
## Samples were drawn using NUTS(diag_e) at Wed Sep 21 12:11:50 2022.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<p>We will leave the analysis of this model to later in the semester when we have more experience with Stan.</p>
</div>
<div id="heteroskedastic-probit" class="section level3 hasAnchor" number="5.2.6">
<h3><span class="header-section-number">5.2.6</span> Heteroskedastic Probit<a href="models-of-binary-outcomes.html#heteroskedastic-probit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can develop the probit model using a “latent variable” or “latent utility” approach.</p>
<p>Suppose an unobserved (or “latent”) outcome variable <span class="math inline">\(y^*\)</span>, so that <span class="math inline">\(y^*_i \sim N(\mu_i, \sigma = 1)\)</span>, where <span class="math inline">\(\mu_i = X_i\beta\)</span>. Then suppose that if <span class="math inline">\(y^*_i \geq 0\)</span>, we observe <span class="math inline">\(y_i = 1\)</span>. If <span class="math inline">\(y^*_i &lt; 0\)</span>, we observe <span class="math inline">\(y_i = 0\)</span>.</p>
<p>A little simulation might help.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="models-of-binary-outcomes.html#cb300-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb300-2"><a href="models-of-binary-outcomes.html#cb300-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb300-3"><a href="models-of-binary-outcomes.html#cb300-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-4"><a href="models-of-binary-outcomes.html#cb300-4" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb300-5"><a href="models-of-binary-outcomes.html#cb300-5" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb300-6"><a href="models-of-binary-outcomes.html#cb300-6" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1<span class="sc">*</span>x</span>
<span id="cb300-7"><a href="models-of-binary-outcomes.html#cb300-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-8"><a href="models-of-binary-outcomes.html#cb300-8" aria-hidden="true" tabindex="-1"></a>y_star <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, mu, <span class="dv">1</span>)</span>
<span id="cb300-9"><a href="models-of-binary-outcomes.html#cb300-9" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(y_star <span class="sc">&gt;=</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb300-10"><a href="models-of-binary-outcomes.html#cb300-10" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(x, y_star, y)</span>
<span id="cb300-11"><a href="models-of-binary-outcomes.html#cb300-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-12"><a href="models-of-binary-outcomes.html#cb300-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y_star, <span class="at">color =</span> <span class="fu">factor</span>(y))) <span class="sc">+</span> </span>
<span id="cb300-13"><a href="models-of-binary-outcomes.html#cb300-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="sc">+</span></span>
<span id="cb300-14"><a href="models-of-binary-outcomes.html#cb300-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> b1, <span class="at">intercept =</span> b0, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span> </span>
<span id="cb300-15"><a href="models-of-binary-outcomes.html#cb300-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span></code></pre></div>
<p><img src="05-02-models-of-binary-outcomes_files/figure-html/unnamed-chunk-23-1.png" width="384" /></p>
<p>An implication of this framework is that <span class="math inline">\(\Pr(y_i = 1 \mid X_i) = \Pr(y^*_i \geq 1 \mid X_i) = \Phi(X_i\beta)\)</span>, which gives us exactly the probit model. Long (1997) develops this further in Section 3.2.</p>
<p>But we can use this framework to generalize the usual probit model into a <em>heteroskedastic probit model</em>. Rather than fix the error of the latent erors to <span class="math inline">\(\sigma = 1\)</span>, we could allow them to vary with a set of explanatory variables so that <span class="math inline">\(\sigma = e^{Z\gamma}\)</span>. (We use <span class="math inline">\(X\beta\)</span> for the linear predictor that belongs to the mean and <span class="math inline">\(Z\gamma\)</span> for the linear predictor that belongs to <span class="math inline">\(\sigma\)</span>.)</p>
<p>The <span class="math inline">\(Z\)</span> variables have an interesting relationship to <span class="math inline">\(\Pr(y_i = 1 \mid X_i)\)</span>. If a variable drives the linear predictor <span class="math inline">\(Z\gamma\)</span> (and therefore the error variance <span class="math inline">\(\sigma^2\)</span>) higher, it pushes <span class="math inline">\(\Pr(y_i = 1 \mid X_i)\)</span> toward 0.5. That is, if the probability of an event is near one, increasing the latent variance <em>decreases</em> the chance of an event. But if the probability of an event is near zero, increasing the latent variance <em>increases</em> the chance of an event. Taken to an extreme, this can produce a non-monotic effect of a variable included linearly in both sets of explanatory variables.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="models-of-binary-outcomes.html#cb301-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb301-2"><a href="models-of-binary-outcomes.html#cb301-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb301-3"><a href="models-of-binary-outcomes.html#cb301-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-4"><a href="models-of-binary-outcomes.html#cb301-4" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb301-5"><a href="models-of-binary-outcomes.html#cb301-5" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb301-6"><a href="models-of-binary-outcomes.html#cb301-6" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1<span class="sc">*</span>x</span>
<span id="cb301-7"><a href="models-of-binary-outcomes.html#cb301-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-8"><a href="models-of-binary-outcomes.html#cb301-8" aria-hidden="true" tabindex="-1"></a>g0 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb301-9"><a href="models-of-binary-outcomes.html#cb301-9" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb301-10"><a href="models-of-binary-outcomes.html#cb301-10" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">exp</span>(g0 <span class="sc">+</span> g1<span class="sc">*</span>x)</span>
<span id="cb301-11"><a href="models-of-binary-outcomes.html#cb301-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-12"><a href="models-of-binary-outcomes.html#cb301-12" aria-hidden="true" tabindex="-1"></a>y_star <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, mu, sigma)</span>
<span id="cb301-13"><a href="models-of-binary-outcomes.html#cb301-13" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(y_star <span class="sc">&gt;=</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb301-14"><a href="models-of-binary-outcomes.html#cb301-14" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(x, y_star, y)</span>
<span id="cb301-15"><a href="models-of-binary-outcomes.html#cb301-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-16"><a href="models-of-binary-outcomes.html#cb301-16" aria-hidden="true" tabindex="-1"></a>gg1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y_star, <span class="at">color =</span> <span class="fu">factor</span>(y))) <span class="sc">+</span> </span>
<span id="cb301-17"><a href="models-of-binary-outcomes.html#cb301-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="sc">+</span></span>
<span id="cb301-18"><a href="models-of-binary-outcomes.html#cb301-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> b1, <span class="at">intercept =</span> b0, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span> </span>
<span id="cb301-19"><a href="models-of-binary-outcomes.html#cb301-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span>
<span id="cb301-20"><a href="models-of-binary-outcomes.html#cb301-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-21"><a href="models-of-binary-outcomes.html#cb301-21" aria-hidden="true" tabindex="-1"></a>pr <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb301-22"><a href="models-of-binary-outcomes.html#cb301-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="dv">0</span>, <span class="at">mean =</span> b0 <span class="sc">+</span> b1<span class="sc">*</span>x, <span class="at">sd =</span> <span class="fu">exp</span>(g0 <span class="sc">+</span> g1<span class="sc">*</span>x)))</span>
<span id="cb301-23"><a href="models-of-binary-outcomes.html#cb301-23" aria-hidden="true" tabindex="-1"></a>gg2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pr, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> pr)) <span class="sc">+</span> </span>
<span id="cb301-24"><a href="models-of-binary-outcomes.html#cb301-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span>
<span id="cb301-25"><a href="models-of-binary-outcomes.html#cb301-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-26"><a href="models-of-binary-outcomes.html#cb301-26" aria-hidden="true" tabindex="-1"></a>gg1 <span class="sc">+</span> gg2</span></code></pre></div>
<p><img src="05-02-models-of-binary-outcomes_files/figure-html/unnamed-chunk-24-1.png" width="768" /></p>
<table>
<colgroup>
<col width="17%" />
<col width="82%" />
</colgroup>
<thead>
<tr class="header">
<th>Quantity</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Distribution</td>
<td><span class="math inline">\(y_i \sim \text{Bernoulli}(\pi_i)\)</span> distribution</td>
</tr>
<tr class="even">
<td>Inverse Link Function</td>
<td><span class="math inline">\(\pi_i = \Phi \left( \frac{X\beta}{e^{Z\gamma}}\right)\)</span></td>
</tr>
<tr class="odd">
<td>Fit Syntax</td>
<td><code>glmx::hetglm(formula, data, family = binomial()</code> (probit link is default)</td>
</tr>
<tr class="even">
<td>Expected Value</td>
<td><span class="math inline">\(\hat{E}(\tilde{y} \mid X_s) = \Phi \left( \frac{X_s\hat{\beta}}{e^{Z_s\hat{\gamma}}}\right)\)</span></td>
</tr>
<tr class="odd">
<td>Manual Computation of EV</td>
<td><code>pi_s = pnorm(X_s %*% beta_hat/exp(Z_s %*% gamma_hat))</code></td>
</tr>
<tr class="even">
<td><code>predict()</code> Computation of EV</td>
<td><code>pi_s &lt;- predict(fit, newdata = s, type = "response")</code></td>
</tr>
<tr class="odd">
<td>Marginal Effect</td>
<td><span class="math inline">\(\frac{ \partial \hat{E}(\tilde{y} \mid X_s)}{\partial x_j} = \phi \left( \frac{X_s\hat{\beta}}{e^{Z_s\hat{\gamma}}}\right) \left[ \frac{\hat{\beta}_j - (X_s\hat{\beta})\hat{\gamma}_j}{e^{Z_s\hat{\gamma}}}\right]\)</span> This assumes that <span class="math inline">\(x_j\)</span> appears in both <span class="math inline">\(X\)</span> and <span class="math inline">\(Z\)</span>. If not, then <span class="math inline">\(\hat{\beta}_j\)</span> or <span class="math inline">\(\hat{\gamma}_j\)</span> is zero and then the marginal effect simplifies.</td>
</tr>
<tr class="even">
<td>Computation of Marginal Effect</td>
<td>See below; it’s a couple of lines and somewhat unexpected.</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="models-of-binary-outcomes.html#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb302-2"><a href="models-of-binary-outcomes.html#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmx)</span>
<span id="cb302-3"><a href="models-of-binary-outcomes.html#cb302-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-4"><a href="models-of-binary-outcomes.html#cb302-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb302-5"><a href="models-of-binary-outcomes.html#cb302-5" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">hetglm</span>(newvote <span class="sc">~</span> neweduc <span class="sc">+</span> closing <span class="sc">+</span> age <span class="sc">+</span> south <span class="sc">+</span> gov <span class="sc">|</span> neweduc <span class="sc">+</span> closing <span class="sc">+</span> age <span class="sc">+</span> south <span class="sc">+</span> gov, </span>
<span id="cb302-6"><a href="models-of-binary-outcomes.html#cb302-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> scobit, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;probit&quot;</span>))</span></code></pre></div>
<p>Now let’s compute quantities of interest. Let’s first compute the expected value or “predicted probability” as <code>neweduc</code> varies from 1 to 8 (all possible values) with all other variables at their medians.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="models-of-binary-outcomes.html#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let education vary across all possible values; else median</span></span>
<span id="cb303-2"><a href="models-of-binary-outcomes.html#cb303-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb303-3"><a href="models-of-binary-outcomes.html#cb303-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">neweduc =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,</span>
<span id="cb303-4"><a href="models-of-binary-outcomes.html#cb303-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">closing =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>closing),</span>
<span id="cb303-5"><a href="models-of-binary-outcomes.html#cb303-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>age),</span>
<span id="cb303-6"><a href="models-of-binary-outcomes.html#cb303-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">south =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>south),</span>
<span id="cb303-7"><a href="models-of-binary-outcomes.html#cb303-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">gov =</span> <span class="fu">median</span>(scobit<span class="sc">$</span>gov)</span>
<span id="cb303-8"><a href="models-of-binary-outcomes.html#cb303-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb303-9"><a href="models-of-binary-outcomes.html#cb303-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-10"><a href="models-of-binary-outcomes.html#cb303-10" aria-hidden="true" tabindex="-1"></a><span class="co"># expected value or &quot;predicted probability&quot; </span></span>
<span id="cb303-11"><a href="models-of-binary-outcomes.html#cb303-11" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>expected_value <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> s, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb303-12"><a href="models-of-binary-outcomes.html#cb303-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-13"><a href="models-of-binary-outcomes.html#cb303-13" aria-hidden="true" tabindex="-1"></a><span class="co"># marginal effect of closing on expected value, analytically</span></span>
<span id="cb303-14"><a href="models-of-binary-outcomes.html#cb303-14" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>expZg <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> s, <span class="at">type =</span> <span class="st">&quot;scale&quot;</span>)</span>
<span id="cb303-15"><a href="models-of-binary-outcomes.html#cb303-15" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>Xb_over_expZg <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> s, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>)  <span class="co"># &lt;- UNEXPECTED BEHAVIOR (FOR ME)</span></span>
<span id="cb303-16"><a href="models-of-binary-outcomes.html#cb303-16" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>Xb <span class="ot">&lt;-</span> s<span class="sc">$</span>Xb_over_expZg<span class="sc">*</span>s<span class="sc">$</span>expZg</span>
<span id="cb303-17"><a href="models-of-binary-outcomes.html#cb303-17" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>marginal_effect <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(s<span class="sc">$</span>Xb<span class="sc">/</span>s<span class="sc">$</span>expZg)<span class="sc">*</span>((<span class="fu">coef</span>(fit)[<span class="st">&quot;neweduc&quot;</span>] <span class="sc">-</span> s<span class="sc">$</span>Xb<span class="sc">*</span><span class="fu">coef</span>(fit)[<span class="st">&quot;(scale)_neweduc&quot;</span>])<span class="sc">/</span>s<span class="sc">$</span>expZg)</span>
<span id="cb303-18"><a href="models-of-binary-outcomes.html#cb303-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-19"><a href="models-of-binary-outcomes.html#cb303-19" aria-hidden="true" tabindex="-1"></a><span class="co"># marginal effect of closing on expected value, *numerically*</span></span>
<span id="cb303-20"><a href="models-of-binary-outcomes.html#cb303-20" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fl">0.00001</span></span>
<span id="cb303-21"><a href="models-of-binary-outcomes.html#cb303-21" aria-hidden="true" tabindex="-1"></a>s_prime <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span></span>
<span id="cb303-22"><a href="models-of-binary-outcomes.html#cb303-22" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(<span class="at">neweduc =</span> neweduc <span class="sc">+</span> delta)</span>
<span id="cb303-23"><a href="models-of-binary-outcomes.html#cb303-23" aria-hidden="true" tabindex="-1"></a>s_prime<span class="sc">$</span>expected_value <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> s_prime, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb303-24"><a href="models-of-binary-outcomes.html#cb303-24" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>marginal_effect <span class="ot">&lt;-</span> (s_prime<span class="sc">$</span>expected_value <span class="sc">-</span> s<span class="sc">$</span>expected_value)<span class="sc">/</span>delta</span></code></pre></div>
<p>Now let’s make a plot of the expected values and marginal effects. The grey lines show the original logit estimates.</p>
<p><img src="05-02-models-of-binary-outcomes_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="models-of-binary-outcomes.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit, fit_logit) <span class="sc">%&gt;%</span></span>
<span id="cb304-2"><a href="models-of-binary-outcomes.html#cb304-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_min =</span> AIC <span class="sc">-</span> <span class="fu">min</span>(AIC),</span>
<span id="cb304-3"><a href="models-of-binary-outcomes.html#cb304-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">akiaike_weights =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>diff_min)<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>diff_min)))</span></code></pre></div>
<pre><code>##           df    AIC diff_min akiaike_weights
## fit       11 111876    0.000    1.000000e+00
## fit_logit  6 112929 1053.012   2.194214e-229</code></pre>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="models-of-binary-outcomes.html#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(fit, fit_logit) <span class="sc">%&gt;%</span></span>
<span id="cb306-2"><a href="models-of-binary-outcomes.html#cb306-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_min =</span> BIC <span class="sc">-</span> <span class="fu">min</span>(BIC),</span>
<span id="cb306-3"><a href="models-of-binary-outcomes.html#cb306-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">post_prob =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>diff_min)<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>diff_min)))</span></code></pre></div>
<pre><code>##           df      BIC diff_min     post_prob
## fit       11 111980.6    0.000  1.000000e+00
## fit_logit  6 112986.1 1005.464 4.637491e-219</code></pre>
<p>Lastly, here’s a replication of Alvarez and Brehm’s classic example modeling ambivalence within abortion attitudes.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="models-of-binary-outcomes.html#cb308-1" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;abhlth&quot;</span>, <span class="st">&quot;abpoor&quot;</span>, <span class="st">&quot;absingle&quot;</span>, <span class="st">&quot;abnomore&quot;</span>, <span class="st">&quot;abdefect&quot;</span>, <span class="st">&quot;abany&quot;</span>, <span class="st">&quot;abrape&quot;</span>, <span class="st">&quot;sexlty&quot;</span>,</span>
<span id="cb308-2"><a href="models-of-binary-outcomes.html#cb308-2" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;relgty&quot;</span>, <span class="st">&quot;sprolfe&quot;</span>, <span class="st">&quot;sprochce&quot;</span>, <span class="st">&quot;abstrgth&quot;</span>, <span class="st">&quot;abimp&quot;</span>, <span class="st">&quot;abinfo&quot;</span>, <span class="st">&quot;abfirm&quot;</span>, </span>
<span id="cb308-3"><a href="models-of-binary-outcomes.html#cb308-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;abcare&quot;</span>, <span class="st">&quot;abproct&quot;</span>, <span class="st">&quot;abconct&quot;</span>, <span class="st">&quot;choice&quot;</span>, <span class="st">&quot;mhealth&quot;</span>, <span class="st">&quot;chealth&quot;</span>, <span class="st">&quot;prolife&quot;</span>, </span>
<span id="cb308-4"><a href="models-of-binary-outcomes.html#cb308-4" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;fechld&quot;</span>, <span class="st">&quot;fefam&quot;</span>, <span class="st">&quot;fehelp&quot;</span>, <span class="st">&quot;fepresch&quot;</span>, <span class="st">&quot;pill&quot;</span>, <span class="st">&quot;teenpill&quot;</span>, <span class="st">&quot;pillok&quot;</span>, </span>
<span id="cb308-5"><a href="models-of-binary-outcomes.html#cb308-5" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;sexeduc&quot;</span>, <span class="st">&quot;divlaw&quot;</span>, <span class="st">&quot;premarsx&quot;</span>, <span class="st">&quot;teensex&quot;</span>, <span class="st">&quot;xmarsex&quot;</span>, <span class="st">&quot;homosex&quot;</span>, <span class="st">&quot;black&quot;</span>,  </span>
<span id="cb308-6"><a href="models-of-binary-outcomes.html#cb308-6" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;male&quot;</span>, <span class="st">&quot;prot&quot;</span>, <span class="st">&quot;cath&quot;</span>, <span class="st">&quot;jew&quot;</span>, <span class="st">&quot;reliten&quot;</span>, <span class="st">&quot;attend&quot;</span>, <span class="st">&quot;prayer&quot;</span>,</span>
<span id="cb308-7"><a href="models-of-binary-outcomes.html#cb308-7" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;eraread&quot;</span>, <span class="st">&quot;erameans&quot;</span>, <span class="st">&quot;era&quot;</span>, <span class="st">&quot;eratell&quot;</span>)</span>
<span id="cb308-8"><a href="models-of-binary-outcomes.html#cb308-8" aria-hidden="true" tabindex="-1"></a>ab <span class="ot">&lt;-</span> <span class="fu">read.fwf</span>(<span class="st">&quot;data/ABGSS.DAT&quot;</span>, </span>
<span id="cb308-9"><a href="models-of-binary-outcomes.html#cb308-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">widths =</span> <span class="fu">list</span>(<span class="fu">rep</span>(<span class="dv">15</span>, <span class="dv">17</span>), <span class="fu">rep</span>(<span class="dv">15</span>, <span class="dv">17</span>), <span class="fu">rep</span>(<span class="dv">15</span>, <span class="dv">13</span>)),</span>
<span id="cb308-10"><a href="models-of-binary-outcomes.html#cb308-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">col.names =</span> col_names) <span class="sc">%&gt;%</span></span>
<span id="cb308-11"><a href="models-of-binary-outcomes.html#cb308-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">na_if</span>(.,  <span class="dv">99999</span>)))</span>
<span id="cb308-12"><a href="models-of-binary-outcomes.html#cb308-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-13"><a href="models-of-binary-outcomes.html#cb308-13" aria-hidden="true" tabindex="-1"></a>fit_probit <span class="ot">&lt;-</span> <span class="fu">glm</span>(abhlth <span class="sc">~</span> black <span class="sc">+</span> male <span class="sc">+</span> cath <span class="sc">+</span> reliten <span class="sc">+</span> attend <span class="sc">+</span> erameans <span class="sc">+</span> era, </span>
<span id="cb308-14"><a href="models-of-binary-outcomes.html#cb308-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> ab, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;probit&quot;</span>))</span>
<span id="cb308-15"><a href="models-of-binary-outcomes.html#cb308-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-16"><a href="models-of-binary-outcomes.html#cb308-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmx)</span>
<span id="cb308-17"><a href="models-of-binary-outcomes.html#cb308-17" aria-hidden="true" tabindex="-1"></a>fit_hetprobit <span class="ot">&lt;-</span> <span class="fu">hetglm</span>(abhlth <span class="sc">~</span> black <span class="sc">+</span> male <span class="sc">+</span> cath <span class="sc">+</span> reliten <span class="sc">+</span> attend <span class="sc">+</span> erameans <span class="sc">+</span> era <span class="sc">|</span> </span>
<span id="cb308-18"><a href="models-of-binary-outcomes.html#cb308-18" aria-hidden="true" tabindex="-1"></a>                       abproct<span class="sc">*</span>abconct <span class="sc">+</span> abimp <span class="sc">+</span> abinfo <span class="sc">+</span> abfirm, </span>
<span id="cb308-19"><a href="models-of-binary-outcomes.html#cb308-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> ab, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;probit&quot;</span>))</span></code></pre></div>
<p>And here’s a bit of code to use Stan to simulate from the posterior.</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb309-1"><a href="models-of-binary-outcomes.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb309-2"><a href="models-of-binary-outcomes.html#cb309-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;     <span class="co">// number of data items in X and Z</span></span>
<span id="cb309-3"><a href="models-of-binary-outcomes.html#cb309-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; K_x;   <span class="co">// number of predictors in X</span></span>
<span id="cb309-4"><a href="models-of-binary-outcomes.html#cb309-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; K_z;   <span class="co">// number of predictors in Z</span></span>
<span id="cb309-5"><a href="models-of-binary-outcomes.html#cb309-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[N, K_x] X;   <span class="co">// predictor matrix Z</span></span>
<span id="cb309-6"><a href="models-of-binary-outcomes.html#cb309-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[N, K_z] Z;   <span class="co">// predictor matrix Z</span></span>
<span id="cb309-7"><a href="models-of-binary-outcomes.html#cb309-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> y[N];           <span class="co">// outcome vector</span></span>
<span id="cb309-8"><a href="models-of-binary-outcomes.html#cb309-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb309-9"><a href="models-of-binary-outcomes.html#cb309-9" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb309-10"><a href="models-of-binary-outcomes.html#cb309-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[K_x] beta;       <span class="co">// coefficients for X</span></span>
<span id="cb309-11"><a href="models-of-binary-outcomes.html#cb309-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[K_z] gamma;       <span class="co">// coefficients for Z</span></span>
<span id="cb309-12"><a href="models-of-binary-outcomes.html#cb309-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb309-13"><a href="models-of-binary-outcomes.html#cb309-13" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed parameters</span> {</span>
<span id="cb309-14"><a href="models-of-binary-outcomes.html#cb309-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] pi;</span>
<span id="cb309-15"><a href="models-of-binary-outcomes.html#cb309-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] Xbeta;</span>
<span id="cb309-16"><a href="models-of-binary-outcomes.html#cb309-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] Zgamma;</span>
<span id="cb309-17"><a href="models-of-binary-outcomes.html#cb309-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb309-18"><a href="models-of-binary-outcomes.html#cb309-18" aria-hidden="true" tabindex="-1"></a>    Xbeta[i] = X[i, ]*beta;</span>
<span id="cb309-19"><a href="models-of-binary-outcomes.html#cb309-19" aria-hidden="true" tabindex="-1"></a>    Zgamma[i] = Z[i, ]*gamma;</span>
<span id="cb309-20"><a href="models-of-binary-outcomes.html#cb309-20" aria-hidden="true" tabindex="-1"></a>    pi[i] = Phi(Xbeta[i]/exp(Zgamma[i]));</span>
<span id="cb309-21"><a href="models-of-binary-outcomes.html#cb309-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb309-22"><a href="models-of-binary-outcomes.html#cb309-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb309-23"><a href="models-of-binary-outcomes.html#cb309-23" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb309-24"><a href="models-of-binary-outcomes.html#cb309-24" aria-hidden="true" tabindex="-1"></a>  y ~ bernoulli(pi);  <span class="co">// likelihood</span></span>
<span id="cb309-25"><a href="models-of-binary-outcomes.html#cb309-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="models-of-binary-outcomes.html#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="co"># listwise delete missing values from all variables of interest</span></span>
<span id="cb310-2"><a href="models-of-binary-outcomes.html#cb310-2" aria-hidden="true" tabindex="-1"></a>ab_stan <span class="ot">&lt;-</span> ab <span class="sc">%&gt;%</span></span>
<span id="cb310-3"><a href="models-of-binary-outcomes.html#cb310-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(abhlth, black, male, cath, reliten, attend, erameans, era, </span>
<span id="cb310-4"><a href="models-of-binary-outcomes.html#cb310-4" aria-hidden="true" tabindex="-1"></a>         abproct, abconct, abimp, abinfo, abfirm) <span class="sc">%&gt;%</span></span>
<span id="cb310-5"><a href="models-of-binary-outcomes.html#cb310-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb310-6"><a href="models-of-binary-outcomes.html#cb310-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-7"><a href="models-of-binary-outcomes.html#cb310-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create X</span></span>
<span id="cb310-8"><a href="models-of-binary-outcomes.html#cb310-8" aria-hidden="true" tabindex="-1"></a>fx <span class="ot">&lt;-</span> abhlth <span class="sc">~</span> black <span class="sc">+</span> male <span class="sc">+</span> cath <span class="sc">+</span> reliten <span class="sc">+</span> attend <span class="sc">+</span> erameans <span class="sc">+</span> era</span>
<span id="cb310-9"><a href="models-of-binary-outcomes.html#cb310-9" aria-hidden="true" tabindex="-1"></a>mfx <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(fx, <span class="at">data =</span> ab_stan)  <span class="co"># model frame</span></span>
<span id="cb310-10"><a href="models-of-binary-outcomes.html#cb310-10" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fx, mfx)         <span class="co"># model matrix X</span></span>
<span id="cb310-11"><a href="models-of-binary-outcomes.html#cb310-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-12"><a href="models-of-binary-outcomes.html#cb310-12" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain the outcome variable y</span></span>
<span id="cb310-13"><a href="models-of-binary-outcomes.html#cb310-13" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">model.response</span>(mfx)</span>
<span id="cb310-14"><a href="models-of-binary-outcomes.html#cb310-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-15"><a href="models-of-binary-outcomes.html#cb310-15" aria-hidden="true" tabindex="-1"></a><span class="co"># create Z</span></span>
<span id="cb310-16"><a href="models-of-binary-outcomes.html#cb310-16" aria-hidden="true" tabindex="-1"></a>fz <span class="ot">&lt;-</span> <span class="er">~</span> abproct<span class="sc">*</span>abconct <span class="sc">+</span> abimp <span class="sc">+</span> abinfo <span class="sc">+</span> abfirm <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb310-17"><a href="models-of-binary-outcomes.html#cb310-17" aria-hidden="true" tabindex="-1"></a>mfz <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(fz, <span class="at">data =</span> ab_stan)  <span class="co"># model frame</span></span>
<span id="cb310-18"><a href="models-of-binary-outcomes.html#cb310-18" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fz, mfz)         <span class="co"># model matrix X</span></span>
<span id="cb310-19"><a href="models-of-binary-outcomes.html#cb310-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-20"><a href="models-of-binary-outcomes.html#cb310-20" aria-hidden="true" tabindex="-1"></a><span class="co"># fit stan model</span></span>
<span id="cb310-21"><a href="models-of-binary-outcomes.html#cb310-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan); <span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb310-22"><a href="models-of-binary-outcomes.html#cb310-22" aria-hidden="true" tabindex="-1"></a>stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> y, <span class="at">X =</span> X, <span class="at">Z =</span> Z,</span>
<span id="cb310-23"><a href="models-of-binary-outcomes.html#cb310-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">N =</span> <span class="fu">nrow</span>(X), <span class="at">K_x =</span> <span class="fu">ncol</span>(X), <span class="at">K_z =</span> <span class="fu">ncol</span>(Z))</span>
<span id="cb310-24"><a href="models-of-binary-outcomes.html#cb310-24" aria-hidden="true" tabindex="-1"></a><span class="co"># stan_opt &lt;- optimizing(hetprob_model, data = stan_data)  # keeps crashing</span></span>
<span id="cb310-25"><a href="models-of-binary-outcomes.html#cb310-25" aria-hidden="true" tabindex="-1"></a>stan_samp <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">sampling</span>(hetprob_model, <span class="at">data =</span> stan_data,</span>
<span id="cb310-26"><a href="models-of-binary-outcomes.html#cb310-26" aria-hidden="true" tabindex="-1"></a>                            <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;beta&quot;</span>, <span class="st">&quot;gamma&quot;</span>),</span>
<span id="cb310-27"><a href="models-of-binary-outcomes.html#cb310-27" aria-hidden="true" tabindex="-1"></a>                            <span class="at">cores =</span> <span class="dv">3</span>,</span>
<span id="cb310-28"><a href="models-of-binary-outcomes.html#cb310-28" aria-hidden="true" tabindex="-1"></a>                            <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb310-29"><a href="models-of-binary-outcomes.html#cb310-29" aria-hidden="true" tabindex="-1"></a>                            <span class="at">iter =</span> <span class="dv">2000</span>)</span></code></pre></div>

</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="measures-of-model-fit.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="week-6-an-explosion-of-quantities-of-interest.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["adv-methods-notes.pdf", "adv-methods-notes.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
